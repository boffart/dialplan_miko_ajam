[miko_ajam_10000333]
exten => 10000333,1,NoCDR()
exten => 10000333,n,Noop(internal calling application: 10000333 1C_SendFax)
exten => 10000333,n,Set(_chan=${chan})
exten => 10000333,n,Set(_faxcallerid=${faxcallerid})
exten => 10000333,n,Set(_faxfile=${faxfile})
exten => 10000333,n,Set(_outbox_path=${ASTSPOOLDIR}/fax/${faxfile})
exten => 10000333,n,Dial(LOCAL/${CALLERID(num)}@miko_ajam_fax_tx,,g)
exten => 10000333,n,Hangup

[miko_ajam_fax_tx]
exten => _X!,1,Noop(------------------- FAX from ${CALLERID(number)} ------------------)
exten => _X!,n,ExecIf($["0" = "0"]?WaitForSilence(500,1,15))
exten => _X!,n,Noop(--- ${WAITSTATUS}  ---)
exten => _X!,n,Answer
exten => _X!,n,Wait(2)
exten => _X!,n,SendFAX(${ASTSPOOLDIR}/fax/${faxfile}.tif)
exten => _X!,n,Set(CDR(userfield)=SendFAX)
exten => _X!,n,Noop(--- ${FAXSTATUS} ---${FAXERROR} ---${REMOTESTATIONID} ---)
exten => _X!,n,Hangup

exten => h,1,Noop(------------------- FAX to ${EXTEN} with ${FAXSTATUS} -----------------)
exten => h,n,GotoIf($["${FAXSTATUS}" = "SUCCESS"]?h,success:h,failed)
exten => h,n(failed),UserEvent(SendFaxStatusFail,Channel: ${chan},CallerID: ${faxcallerid})
exten => h,n,Hangup
exten => h,n(success),UserEvent(SendFaxStatusOk,Channel: ${chan},CallerID: ${faxcallerid})
exten => h,n,Set(CDR(recordingfile)=${faxfile}.tif)
exten => h,n,Hangup
;--== end of [miko_ajam_fax_tx] ==--;
